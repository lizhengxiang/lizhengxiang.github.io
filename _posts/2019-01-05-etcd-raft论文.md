---
date: 2019-01-05 04:46:12+00:00
layout: post
title: etcd-raft论文
thread: 1
categories: etcd
tags: 技术文章
---

### raft 特性

1 强领导：日志只能从领导者发给其他服务器，这样简化了对复制日志的管理

2 领导选举：raft算法使用一个随机计时器来领导选举，比其他一致性算法都必须实现心跳检测增加了一点机制，在解决冲突的时候更加简单

3 成员关系调整：raft使用一种共同一致的方法来处理集群成员变化问题，在这种方法下，处于调整过程中的两种不同的配置集群中大多数机器会有重叠，这就使得集群在成员变换的时候依然可以继续工作。

### 复制状态机

![复制状态机]({{ site.url }}/assets/statemachine.jpg)

一致性算法管理者来自客户端指令的复制日志，状态机从日志中处理相同顺序的相同指令，所以产生的结果也相同。

复制状态机通常是复制日志实现的。

一致性算法包含以下特点：

1 安全性保证：在非拜占庭容错的情况下，包括网络延迟，丢包，错乱等都可以确保正确。

2 可用性：

3 不依赖时序保证一致性：物理时钟错乱或极端的消息延迟可能只有最坏的情况下才会导致可用性问题。

raft 通过选举一个高贵的领导人，然后给予他管理复制日志的责任来实现一致性，领导人从客户端接收日志条目，把日志复制到其他机器上，并且到保证安全性的时候告诉其他服务器应用日志到他们的状态机中，拥有一个领导人大大简化了复制日志管理，领导人不用和其他服务器协商。

通过领导人的方式，raft 一致性问题分解成三个相对独立的子问题

1 领导人选举：一个新的领导人被选举出来，当现存的领导人宕机时。

2 日志复制：领导人必须从客户端接收日志然后复制到集群中的其他节点，并强制要求其它节点的日志和自己的日志相同。

3 安全性：raft 安全性关键在于状态机的安全，如果有任何的服务器节点已经应用了一个确定的日志条目到它的状态机中，那么其他服务器节点不能在同一个日志索引位置应用一个不同的指令。

### 状态

|状态 |所有服务器上持久从在的东西|
|---|:---|
|currentTerm|最后一次知道的任期号（初始化为0，持续递增）|
|votedFor|当前获得选票的候选人id|
|log[]	|日志条目集，每一个条目包含一个用户状态机执行的指令和收到的任期号|



|状态 |所有服务器上经常变的|
|---|:---|
|commitIndex|已知的最大已经被提交的日志条目的索引|
|lastApplied|最后被应用到状态机的日志条目索引值（初始化为0，持续递增）|


|状态 |在领导人里经常变的（选举后重新开始）|
|---|:---|
|commitIndex|已知的最大已经被提交的日志条目的索引|
|lastApplied|最后被应用到状态机的日志条目索引值（初始化为0，持续递增）|
